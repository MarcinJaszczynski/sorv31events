# Nginx configuration for serving compressed assets
# Add this to your server block in nginx.conf

location ~* \.(js|css|svg|woff2?|ttf|eot)$ {
    # Try compressed version first
    location ~ \.(js|css)$ {
        add_header Vary Accept-Encoding;
        
        # Try Brotli first
        location ~ \.(js|css)$ {
            try_files $uri$arg_v.br $uri$arg_v =404;
            add_header Content-Encoding br;
            add_header Cache-Control "public, max-age=31536000, immutable";
        }
        
        # Fallback to Gzip
        location ~ \.(js|css)$ {
            try_files $uri$arg_v.gz $uri$arg_v =404;
            add_header Content-Encoding gzip;
            add_header Cache-Control "public, max-age=31536000, immutable";
        }
    }
    
    # Static assets caching
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header Vary Accept-Encoding;
    
    # Security headers
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options DENY;
    add_header X-XSS-Protection "1; mode=block";
}

# Enable gzip compression
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_comp_level 6;
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/javascript
    application/xml+rss
    application/json
    image/svg+xml;

# Enable Brotli compression (if module available)
brotli on;
brotli_comp_level 6;
brotli_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/javascript
    application/xml+rss
    application/json
    image/svg+xml;
